(function(t){function e(e){for(var i,r,o=e[0],c=e[1],l=e[2],u=0,h=[];u<o.length;u++)r=o[u],a[r]&&h.push(a[r][0]),a[r]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);d&&d(e);while(h.length)h.shift()();return s.push.apply(s,l||[]),n()}function n(){for(var t,e=0;e<s.length;e++){for(var n=s[e],i=!0,o=1;o<n.length;o++){var c=n[o];0!==a[c]&&(i=!1)}i&&(s.splice(e--,1),t=r(r.s=n[0]))}return t}var i={},a={app:0},s=[];function r(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=i,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var d=c;s.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"1fef":function(t,e,n){"use strict";var i=n("45a8"),a=n.n(i);a.a},"45a8":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);var i=n("2b0e"),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[t._m(0),n("div",{staticStyle:{padding:"20px",flex:"1 1"}},[n("h4",[t._v("Multichannel Midi (SMF1, multiple tracks)")]),n("midi-file",{ref:"mixer",attrs:{"num-tracks":4,"assign-channel":!0},on:{input:t.newMix}},[n("i",{staticClass:"fas fa-file-download button",on:{click:function(e){return t.$refs.mixer.save("smf1.mid")}}})]),n("div",{staticClass:"pulse"},[n("transition",{attrs:{name:"pulse"}},[n("i",{key:t.pulse1,staticClass:"fas fa-arrow-circle-down arrow"})])],1),n("h4",[t._v("Multichannel Midi (SMF0, single track)")]),n("midi-file",{ref:"out",attrs:{"num-tracks":1}},[n("i",{staticClass:"fas fa-file-download button",on:{click:function(e){return t.$refs.out.save("smf0.mid")}}})]),n("div",{staticClass:"pulse"},[n("transition",{attrs:{name:"pulse"}},[n("i",{key:t.pulse2,staticClass:"fas fa-arrow-circle-down arrow"})])],1),n("h4",[t._v("Final midi file")]),n("midi-file",{ref:"out1",attrs:{"num-tracks":1}})],1)])},s=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{padding:"20px",flex:"1 1"}},[n("h1",[t._v("Midi Squeezer")]),n("h2",{staticStyle:{"margin-top":"-20px","font-style":"italic"}},[t._v("(Roland Juno DS pattern sequencer tool)")]),n("h3",[t._v("About")]),n("p",[t._v("\n      Creates a mulitrack Midi file (smf0) and allows to resample it to fit into a\n      number of target bars.\n      Please read the corresponding article "),n("a",{staticStyle:{"text-decoration":"none"},attrs:{href:"TODO"}},[t._v("here")]),t._v("!\n    ")]),n("h3",[t._v("Limitations")]),n("li",[t._v("only smf0 is supported")]),n("li",[t._v("only noteOn + cvChange events are supported")]),n("li",[t._v("all input files must have same signature + bpm and start time")]),n("h3",[t._v("Usage")]),n("li",[t._v("drop a few midi files on the corresponding channels")]),n("li",[t._v("bpm of first track will dictate bpm of output")]),n("li",[t._v("merged file will be updated automatically")]),n("li",[t._v("adjust the target limits (bars, min speed, signature, ..)")]),n("li",[t._v("final file with compressed timings will update automatically")])])}],r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{on:{drop:t.drop,dragover:function(t){return t.preventDefault()}}},[t.midi?n("div",{staticClass:"sequencer"},t._l(t.midi.tracks,function(e,i){return n("midi-track",{key:i,staticStyle:{margin:"10px"},attrs:{index:i,track:e,"assign-channel":t.assignChannel},on:{input:function(e){return t.$emit(e.type,e)},delete:function(e){return t.remove(i)},drop:function(e){return t.drop(e,i)}}})}),1):t._e(),t.$slots.default?n("div",{staticStyle:{display:"flex","padding-right":"20px"}},[n("div",{staticStyle:{flex:"1 1"}}),n("div",[t._t("default")],2)]):t._e()])},o=[],c=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:{track:!0,over:t.over},on:{drop:function(e){t.$emit("drop",e),t.over=!1},dragover:function(e){e.preventDefault(),t.over=!0},dragleave:function(e){e.preventDefault(),t.over=!1}}},[t.track?n("div",{staticClass:"content"},[n("div",{staticClass:"channels heading"},t._l(t.channels,function(e){return n("div",{key:e,class:{c:!0,on:-1!==t.track.channel.indexOf(e-1)},attrs:{title:"Channel "+e+" "+(-1!==t.track.channel.indexOf(e-1)?"(used)":"(not used)")}})}),0),t.track.name?n("div",{staticClass:"name"},[t._v("\n      "+t._s(t.track.name)+"\n    ")]):t._e(),t.track.signature?n("div",{staticClass:"signature"},[t._v("\n      "+t._s(t.track.signature.numerator)+"/"+t._s(t.track.signature.denominator)+"\n    ")]):t._e(),t.track.bpm?n("div",{staticClass:"tempo"},[n("input",{domProps:{value:t.track.bpm},on:{blur:t.setTempo,keydown:function(t){"Enter"===t.key&&t.currentTarget.blur()}}}),t._v("bpm\n    ")]):n("div",{staticClass:"tempo error",on:{click:function(e){t.track.bpm=120}}},[t._v("\n      no tempo\n    ")]),t.track.duration?n("div",{staticClass:"duration"},[t._v("\n      "+t._s(t.displayMinutes(t.track.duration))+"min\n    ")]):t._e(),n("div",{staticClass:"close",on:{click:function(e){return t.$emit("delete")}}},[n("i",{staticClass:"fas fa-times"}),t._e()])]):n("div",{staticClass:"content empty"},[n("div",{staticClass:"channels heading"},t._l(t.channels,function(e){return n("div",{key:e,class:{c:!0,on:t.assignChannel&&e===t.index+1},attrs:{title:"Channel "+(e+1)}})}),0),n("div",[t.assignChannel?[t._v("\n        drop midi file here for channel "+t._s(t.index+1)+"\n      ")]:[t._v("\n        drop midi file here "),n("i",[t._v("(channel info won't be touched)")])]],2)])])},l=[];function d(t){return new Promise(e=>{const n=t.dataTransfer.files[0],i=new FileReader;i.onload=function(t){e(t.target.result)},console.log(n),i.readAsArrayBuffer(n),t.preventDefault()})}function u(t){return`${Math.floor(t)}.${Math.round(60*(t-Math.floor(t)))}`}function h(t,e,n="application/octet-stream"){const i=document.createElement("a"),a=new Blob([t],{type:n});i.href=window.URL.createObjectURL(a),i.download=e,i.click()}var p={name:"Track",data:()=>({over:!1,channels:4}),props:{track:{type:Object},assignChannel:{type:Boolean},index:{type:Number}},computed:{},methods:{displayMinutes:u,setTempo(t){this.track.bpm=Number(t.currentTarget.value),this.$forceUpdate()}}},f=p,m=(n("1fef"),n("2877")),v=Object(m["a"])(f,c,l,!1,null,"3c771ddf",null),g=v.exports,y=n("cf05"),k=n("8eb2");const b=6e7;class _{constructor(t,e){this.data=t,this.header=e}emitUpdate(){this.dispatchEvent&&this.dispatchEvent({type:"input"})}toJSON(){return{data:this.data}}get ticks(){return this.data.reduce((t,e)=>t+(e.delta||0),0)}get quarters(){this.signature.denominator;return this.beats/this.signature.numerator}get duration(){return this.bpm?this.ticks/this.header.division*this.usPerBeat/b:null}get signature(){const t=this.data.find(t=>t.timeSignature);return t?t.timeSignature:null}get usPerBeat(){const t=this.data.find(t=>t.setTempo);return t?t.setTempo.microsecondsPerBeat:null}get bpm(){const t=this.usPerBeat;return t?b/t:null}set channel(t){this.data.forEach(e=>{"channel"in e&&(e.channel=t)}),this.emitUpdate()}get channel(){const t={};return this.data.forEach(e=>{"channel"in e&&(t[e.channel]=!0)}),Object.keys(t).map(Number)}get division(){this.data.forEach(t=>{"channel"in t&&(t.channel=channel)})}apply(t=(()=>{})){this.data.forEach(t)}histogram(t=(()=>!0)){const e={};return this.data.forEach(n=>{n.delta&&t(n)&&(e[n.delta]=(e[n.delta]||0)+1)}),e}set bpm(t){t=Math.max(20,t);const e=this.data.find(t=>t.setTempo);e?e.setTempo.microsecondsPerBeat=b/t:this.data.splice(0,0,{delta:0,setTempo:{microsecondsPerBeat:b/t}}),this.emitUpdate()}get name(){const t=this.data.find(t=>t.trackName);return t?t.trackName:null}set name(t){const e=this.data.find(t=>t.trackName);e?e.trackName=t:this.data.splice(0,0,{delta:0,trackName:t}),this.emitUpdate()}get copy(){return new _(JSON.parse(JSON.stringify(this.data)),this.header)}merge(t){return this.data.splice(this.data.length-1,0,...t.data),this}}const w={format:0,tracks:[]};class O{static async fromBuffer(t){const e=await Object(y["a"])(t);return new O(e)}constructor(t=w,e=4,n){this.assignChannel=n,this.data=t,this.tracks=[];while(this.tracks.length<e)this.tracks.push(null);this.addTrack(this)}toJSON(t){if("data"===t)return this.data}get header(){const t=Object.assign({},this.data);return delete t.tracks,t}emitUpdate(){this.dispatchEvent&&this.dispatchEvent({type:"input",midiFile:t=>this.copy(t)})}histogram(t=(()=>!0)){const e={};return this.tracks.forEach(n=>{if(!n)return;const i=n.histogram(t);for(let t in i)e[t]=(e[t]||0)+i[t]}),e}get division(){return this.data.division}set division(t=this.division){const e=t/this.division;let n=0;const i=t=>i=>{if(i.delta){n+=i.delta;const a=Math.round(i.delta*e)/e!==i.delta;if(a)throw new Error(`midi event aliased (delta: ${n})`);t||(i.delta*=e)}return!0};this.nonEmpty.forEach(t=>{t.apply(i(!0))}),this.emitUpdate()}addTrack(t,e){if(void 0===e&&(e=this.tracks.findIndex(t=>!t)),this.data.division){if(this.data.division!==t.data.division)throw new Error("division of midi tracks does not match")}else this.data.division=t.data.division;if(0!==this.data.format)throw new Error("only midi format 0 supported");const n=t.data.tracks.slice().map(t=>{const e=new _(t,this.header);e.dispatchEvent=(()=>this.emitUpdate());const n=this.tracks.find(t=>t&&t.bpm);return n&&(e.bpm?!e.bpm===n.bpm&&alert(`bpm missmatch ${n.bpm} (present), ${e.bpm} (new file)`):e.bpm=n.bpm),e});if(n.length>1&&(n.forEach((t,e)=>{if(t.channel.length>1)throw new Error(`Track ${e} sends data to multiple channels.\n          This is not supported.\n          Only smf0 files are supported`)}),this.tracks=n),n.length>0){const t=n[0];this.assignChannel&&(t.channel=e),this.tracks.splice(e,1,t)}this.emitUpdate()}get nonEmpty(){return this.tracks.filter(t=>!!t)}async toBuffer(){const t=Object.assign({},this.data,{tracks:this.nonEmpty.map(t=>t.data)}),e=await Object(k["a"])(t);return e}remove(t){this.tracks.splice(t,1,null),this.emitUpdate()}copy(t){const e=t&&this.nonEmpty.length>0?[this.nonEmpty.slice(1).reduce((t,e)=>t.merge(e),this.nonEmpty[0].copy)]:this.nonEmpty,n=Object.assign({},this.data,{tracks:e.map(t=>t.data)});return e.length>0?new O(JSON.parse(JSON.stringify(n)),e.length):new O(void 0)}}n("3e8f");var E={name:"File",props:{buttons:{type:Boolean,default:!1},numTracks:{type:Number,default:1},assignChannel:{type:Boolean,default:!1}},data(){return{midi:new O(void 0,this.numTracks,this.assignChannel)}},mounted(){this.midi.dispatchEvent=(t=>{this.$emit(t.type,t)})},methods:{remove(t){this.midi.remove(t)},async save(t="midi.mid"){const e=await this.midi.toBuffer("Multichannel");h(e,t),console.log(e,this.lastBuffer)},async drop(t,e){t.preventDefault(),t.stopPropagation();const n=await d(t);this.loadFromBuffer(n,e)},async loadFromBuffer(t,e){this.lastBuffer=t.slice();const n=await O.fromBuffer(t);return this.load(n,e)},async load(t,e){0===t.nonEmpty.length?this.midi=new O(void 0,this.numTracks,this.assignChannel):this.midi?(this.midi.addTrack(t,e),console.log("noteOn",this.midi.histogram(t=>!!t.noteOn)),console.log("noteOff",this.midi.histogram(t=>!!t.noteOff)),console.log(this.midi.histogram())):this.midi=t}},components:{MidiTrack:g}},x=E,C=(n("c643"),Object(m["a"])(x,r,o,!1,null,null,null)),M=C.exports,S={name:"App",data(){return{pulse1:0,pulse2:0}},methods:{async newMix(t){const e=t.midiFile(!0);this.$refs.out.load(e,0),this.$forceUpdate(),this.pulse1++}},components:{MidiFile:M}},T=S,j=(n("5c0b"),Object(m["a"])(T,a,s,!1,null,null,null)),$=j.exports;i["a"].config.productionTip=!1,new i["a"]({el:"#app",components:{App:$},render:function(t){return t("App")}})},"5c0b":function(t,e,n){"use strict";var i=n("5e27"),a=n.n(i);a.a},"5e27":function(t,e,n){},c643:function(t,e,n){"use strict";var i=n("fffb"),a=n.n(i);a.a},fffb:function(t,e,n){}});
//# sourceMappingURL=app.5282bba2.js.map